<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>LeafCareBot</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tab { display: none; }
        .tab.active { display: block; }
        button { margin: 5px; padding: 10px 20px; }
        input, textarea { width: 300px; margin: 5px 0; padding: 8px; }
        .response { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background-color: #f7f7f7; }
    </style>
</head>
<body>
    <h1>ğŸŒ¿ LeafCareBot</h1>

    <div id="auth-tab" class="tab active">
        <h2>ÄÄƒng kÃ½ / ÄÄƒng nháº­p</h2>
        <input type="text" id="username" placeholder="Username"><br>
        <input type="password" id="password" placeholder="Password"><br>
        <button onclick="registerUser()">ÄÄƒng kÃ½</button>
        <button onclick="loginUser()">ÄÄƒng nháº­p</button>
    </div>

    <div id="chat-tab" class="tab">
        <h2>Chat vá»›i LeafCareBot</h2>
        <textarea id="chatInput" placeholder="Nháº­p cÃ¢u há»i cá»§a báº¡n..."></textarea><br>
        <button onclick="sendChat()">Gá»­i Chat</button>
        <div id="chatResponse" class="response"></div>
    </div>

    <div id="diagnosis-tab" class="tab">
        <h2>Cháº©n Ä‘oÃ¡n bá»‡nh cho cÃ¢y</h2>
        <input type="file" id="imageInput"><br>
        <button onclick="sendDiagnosis()">Gá»­i áº¢nh</button>
        <div id="diagnosisResponse" class="response"></div>
    </div>

    <script>
        const apiUrl = "https://leafcarebot.onrender.com";

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
        }

        async function registerUser() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const response = await fetch(`${apiUrl}/auth/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });

            const data = await response.json();
            if (response.ok) {
                alert(`ÄÄƒng kÃ½ thÃ nh cÃ´ng cho ${data.username}`);
            } else {
                alert(data.detail || "ÄÄƒng kÃ½ tháº¥t báº¡i!");
            }
        }

        async function loginUser() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const response = await fetch(`${apiUrl}/auth/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });

            const data = await response.json();
            if (response.ok) {
                alert(`ÄÄƒng nháº­p thÃ nh cÃ´ng: ${data.username}`);
                showTab('chat');
            } else {
                alert(data.detail || "ÄÄƒng nháº­p tháº¥t báº¡i!");
            }
        }

        async function sendChat() {
            const chatInput = document.getElementById("chatInput").value;
            const response = await fetch(`${apiUrl}/chat/chatbot`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: chatInput }),
                credentials: 'include'
            });

            const data = await response.json();
            if (response.ok) {
                document.getElementById("chatResponse").innerText = data.response;
            } else {
                alert(data.detail || "Báº¡n cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ chat!");
                showTab('auth');
            }
        }

        async function sendDiagnosis() {
            const fileInput = document.getElementById("imageInput").files[0];
            if (!fileInput) {
                alert("Vui lÃ²ng chá»n áº£nh!");
                return;
            }

            const formData = new FormData();
            formData.append("file", fileInput);

            const response = await fetch(`${apiUrl}/diagnosis/diagnosis_plant`, {
                method: "POST",
                body: formData,
                credentials: 'include'
            });

            const data = await response.json();
            if (response.ok) {
                let output = `
                    ğŸ“‹ <strong>Dá»± Ä‘oÃ¡n:</strong> ${data.predicted_class}<br>
                    ğŸ’¬ <strong>Khuyáº¿n nghá»‹:</strong> ${data.recommendations.join("<br>")}
                `;
                document.getElementById("diagnosisResponse").innerHTML = output;
            } else {
                alert(data.detail || "Báº¡n cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ cháº©n Ä‘oÃ¡n!");
                showTab('auth');
            }
        }
    </script>
</body>
</html>
